var InputManager=pc.createScript("inputManager");InputManager.attributes.add("gameLogicsEntity",{type:"entity",default:null,title:"Game Logics Entity"}),InputManager.attributes.add("cameraEntity",{type:"entity",default:null,title:"Camera Entity"}),InputManager.prototype.initialize=function(){this.gameLogics=this.gameLogicsEntity.script.gameLogics,this._mouseWasPressedThisFrame=!1,this.mouseWasPressedThisFrame=!1,this._wasMouseDown=!1,this._isMouseDown=!1,this._mousePos=null,this._mouseDownTimer=0,this.isMouseDown=!1,this.isMousePressed=!1,this.mousePos=null,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this)}),this)},InputManager.prototype.onTouchStart=function(s){s.touches.length,this._mouseDownTimer=0,s.event.preventDefault()},InputManager.prototype.onTouchMove=function(s){var e=s.touches;this._mousePos=new pc.Vec2(e[0].x,e[0].y),s.event.preventDefault()},InputManager.prototype.onTouchEnd=function(s){s.touches.length,this._isMousePressed=!0,s.event.preventDefault()},InputManager.prototype.onTouchCancel=function(s){s.touches.length,s.event.preventDefault()},InputManager.prototype.onTouchStartEndCancel=function(s){var e=s.touches;this.gameLogics.isCursorInScreen?1==e.length?(this._mouseDownTimer=0,this._isMouseDown=!0,this._mousePos=new pc.Vec2(e[0].x,e[0].y)):0==e.length?(this._mousePos=null,this._isMouseDown=!1):(this._isMouseDown=!1,this._wasMouseDown=!1,this._mousePos=null):(this._mouseDownTimer=1e3,this._isMouseDown=!1,this._wasMouseDown=!1,this.mousePos=null)},InputManager.prototype.onMouseMove=function(s){this._mousePos?(this._mousePos.x=s.x,this._mousePos.y=s.y):this._mousePos=new pc.Vec2(s.x,s.y)},InputManager.prototype.onMouseDown=function(s){s.button===pc.MOUSEBUTTON_LEFT&&this.gameLogics.isCursorInScreen&&(this._mouseDownTimer=0,this._isMouseDown=!0,this.mouseWasPressedThisFrame||(this._mouseWasPressedThisFrame=!0))},InputManager.prototype.onMouseUp=function(s){s.button===pc.MOUSEBUTTON_LEFT&&this.gameLogics.isCursorInScreen&&(this._isMouseDown=!1,this._mouseDownTimer<.5&&(this._isMousePressed=!0))},InputManager.prototype.update=function(s){this.mouseWasPressedThisFrame=this._mouseWasPressedThisFrame,this.isMouseDown=this._isMouseDown,this.isMousePressed=this._isMousePressed,//!this.isMouseDown && this._wasMouseDown && this._mouseDownTimer < 0.5;
this._isMousePressed=!1,this._mouseWasPressedThisFrame=!1,null!=this._mousePos&&(this.mousePos=this._mousePos.clone()),null!=this._mousePos||this.isMousePressed||(this.mousePos=null),this._mouseDownTimer+=s};var ReactionGrid=pc.createScript("reactionGrid");ReactionGrid.attributes.add("nrOfRings",{type:"number",default:15}),ReactionGrid.attributes.add("pixRendererEntity",{type:"entity",default:null,title:"pix Renderer Entity PC"}),ReactionGrid.attributes.add("pixRendererEntityPhone",{type:"entity",default:null,title:"pix Renderer Entity Phone"});var gridTypeEnum={Flat:1,Pointy:2};ReactionGrid.attributes.add("gridType",{type:"number",enum:Object.entries(gridTypeEnum).map((i=>{var t={};return t[i[0]]=i[1],t})),default:1}),ReactionGrid.attributes.add("pixSpacingX",{type:"number",title:"Pix Spacing X",description:"The space between the PIX centres.",default:1.1,min:.1,max:5}),ReactionGrid.attributes.add("pixSpacingY",{type:"number",title:"Pix Spacing Y",description:"The space between the PIX centres.",default:1.1,min:.1,max:5}),ReactionGrid.attributes.add("phonePixSpacingX",{type:"number",title:"Pix Spacing X phone",description:"The space between the PIX centres on phone.",default:1.1,min:.1,max:5}),ReactionGrid.attributes.add("phonePixSpacingY",{type:"number",title:"Pix Spacing Y phone",description:"The space between the PIX centres on phone.",default:1.1,min:.1,max:5}),ReactionGrid.prototype.initialize=function(){this.setUp()},ReactionGrid.prototype.setUp=function(){switch(this.currentNumberOfRings=1,this.sizeTimer=2,this.size=1,this.originalNumberOfRings=this.nrOfRings,this.debug=!1,this.app.touch?(this.currentPixSpacingX=this.phonePixSpacingX,this.currentPixSpacingY=this.phonePixSpacingY,this.pixEntityProto=this.pixRendererEntityPhone):(this.currentPixSpacingX=this.pixSpacingX,this.currentPixSpacingY=this.pixSpacingY,this.pixEntityProto=this.pixRendererEntity),this.oldPixSpacingX=this.currentPixSpacingX,this.oldPixSpacingY=this.currentPixSpacingY,this.updateArray=!1,this.hasBeen=[],this.hightLightOrder=!1,this.hightLightArray=[],this.oldLightArray=[],this.currentIndex=0,this.indexArray=0,this.pulse=!1,this.currentPulse=!0,this.pulseAmount=0,this.pulseTimer=0,this.gridType){case gridTypeEnum.Pointy:this.layout_type=layout_pointy;break;case gridTypeEnum.Flat:default:this.layout_type=layout_flat}this.layout=new Layout(this.layout_type,new Point(this.currentPixSpacingX,this.currentPixSpacingY),new Point(0,0)),this.pixTable=new Map,this.spawnHexagons(),this.increaseGridSize()},ReactionGrid.prototype.update=function(i){this.app.touch?(this.currentPixSpacingX=this.phonePixSpacingX,this.currentPixSpacingY=this.phonePixSpacingY,this.pixEntityProto=this.pixRendererEntityPhone):(this.currentPixSpacingX=this.pixSpacingX,this.currentPixSpacingY=this.pixSpacingY,this.pixEntityProto=this.pixRendererEntity),this.reSizeSpacing(),this.oldPixSpacingX=this.currentPixSpacingX,this.oldPixSpacingY=this.currentPixSpacingY},ReactionGrid.prototype.getPixCordFromPosition=function(i){var t=this.layout;return hex_round(pixel_to_hex(t,new Point(i.x,i.z)))},ReactionGrid.prototype.getPositionFromPixCord=function(i){var t=this.layout,e=hex_to_pixel(t,i);return new pc.Vec3(e.x,0,e.y)},ReactionGrid.prototype.hasPix=function(i){return this.pixTable.has(hex_to_string(i))},ReactionGrid.prototype.getCurrentPix=function(){var i=this.hightLightArray[this.currentIndex];return this.currentIndex++,i},ReactionGrid.prototype.selectPix=function(i){i.script.pixTile.pixCliked()},ReactionGrid.prototype.finishedMemory=function(){console.log("finishedMemory"),this.hightLightOrder=!0,this.indexArray=0,this.createNewArray(),this.updateArray=!0},ReactionGrid.prototype.getPix=function(i){return this.pixTable.get(hex_to_string(i))},ReactionGrid.prototype.getAllPixAsArray=function(){for(var i=Array.from(this.pixTable.keys()),t=i.length,e=[],r=0;r<t;r++){var n=string_to_hex(i[r]),a=this.getPix(n);null!=a&&e.push(a)}return e},ReactionGrid.prototype.setPix=function(i,t){var e=hex_to_string(i),r=t.name+"_q_"+i.q+"_r_"+i.r+"_s_"+i.s;t.name=r,this.pixTable.set(e,t);var n=hex_to_pixel(this.layout,i);t.setPosition(n.x,0,n.y)},ReactionGrid.prototype.createPix=function(){var i=this.pixEntityProto.clone();return i.setPosition(new pc.Vec3(0,0,0)),this.entity.addChild(i),i.enabled=!0,i},ReactionGrid.prototype.realignPixSpacing=function(){this.layout=new Layout(this.layout_type,new Point(this.currentPixSpacingX,this.currentPixSpacingY),new Point(0,0)),this.pixTable.forEach(((i,t)=>{this.setPix(string_to_hex(t),i)})),this.oldPixSpacing=this.pixSpacing},ReactionGrid.prototype.resetGrid=function(){this.pixTable.forEach(((i,t)=>{i.destroy()})),this.pixTable.clear(),this.pixTable=new Map,this.nrOfRings=this.originalNumberOfRings,this.spawnHexagons(),this.increaseGridSize(),this.oldPixSpacing=this.pixSpacing},ReactionGrid.prototype.arrayContains=function(i,t){var e=!1;if(i.length<0||null==i)return e;for(var r=0;r<i.length;r++)i[r]==t&&(e=!0);return e},ReactionGrid.prototype.spawnHexagons=function(){this.app.touch?(this.currentPixSpacingX=this.phonePixSpacingX,this.currentPixSpacingY=this.phonePixSpacingY,this.pixEntityProto=this.pixRendererEntityPhone):(this.currentPixSpacingX=this.pixSpacingX,this.currentPixSpacingY=this.pixSpacingY,this.pixEntityProto=this.pixRendererEntity);for(var i=-this.nrOfRings;i<=this.nrOfRings;i++)for(var t=-this.nrOfRings;t<=this.nrOfRings;t++)for(var e=-this.nrOfRings;e<=this.nrOfRings;e++){if(i+t+e==0){var r=new Hex(i,t,e),n=this.createPix();this.setPix(r,n),n.enabled=!1,0==i&&0==t&&0==e&&(n.script.pixTile.doOnce=!0)}}},ReactionGrid.prototype.increaseGridSize=function(){for(var i=-this.currentNumberOfRings;i<=this.currentNumberOfRings;i++)for(var t=-this.currentNumberOfRings;t<=this.currentNumberOfRings;t++)for(var e=-this.currentNumberOfRings;e<=this.currentNumberOfRings;e++){if(i+t+e==0){var r=new Hex(i,t,e);if(null==this.getPix(r)){var n=this.createPix();this.setPix(r,n)}else{this.getPix(r).enabled=!0}}}},ReactionGrid.prototype.createPixAtCord=function(i){var t=pixTierEnum.Legendary,e=this.createPix(t,6);this.setPix(i,e)},ReactionGrid.prototype.loopIndex=function(i,t){return i=parseInt((i+1)%t.length),this.debug&&console.log(i),i},ReactionGrid.prototype.resetArray=function(){this.pixTable.forEach(((i,t)=>{i.script.pixTile.deHightLight()}))},ReactionGrid.prototype.hightLightAll=function(){this.pixTable.forEach(((i,t)=>{i.script.pixTile.hightLight()}))},ReactionGrid.prototype.resetAll=function(){this.resetArray(this.hightLightArray),this.indexArray=0,this.updateArray=!0},ReactionGrid.prototype.reSizeSpacing=function(){this.oldPixSpacingX==this.currentPixSpacingX&&this.oldPixSpacingY==this.currentPixSpacingY||this.realignPixSpacing()},ReactionGrid.prototype.createNewArray=function(){return this.debug&&console.log("new array"),this.debug&&console.log(this.hightLightArray),this.hightLightArray},ReactionGrid.prototype.hightLightPixInArray=function(i,t){if(!(this.hightLightArray.length<=0&&this.hightLightArray.length<this.indexArray)&&"undefined"!=this.hightLightArray[this.indexArray]){var e=this.hightLightArray[this.indexArray].script.pixTile;return e.canBeClicked()||e.higeLightType(colorMode.HigheLight,i),this.indexArray++,this.indexArray>=this.hightLightArray.length&&(this.indexArray=0,t=!1),t}},ReactionGrid.prototype.createRandomOrder=function(i){if(console.log("createRandomOrder"),null!=this.pixTable){var t=Array.from(this.pixTable.keys());i>t.length&&(console.log("length is larger than array, decrease arrayLength"),i=t.length);var e=[],r=[];r=this.createNonRepetingRandomNumbersArray(r,i);for(var n=0;n<i;n++){var a=t[r[n]];console.log("pix cord = "+a);var o=this.pixTable.get(a);o?e.push(o):console.log("did not get entity from pixTable")}return e}console.log("pixTable is null")},ReactionGrid.prototype.createNonRepetingRandomNumbersArray=function(i,t){var e,r=Array.from(this.pixTable.keys());if(r<t)return"length is larger than array";for(var n=0;n<t;n++){for(e=CreateRandomNumber(0,r.length-1);this.arrayContains(i,e);)e=CreateRandomNumber(0,r.length-1);i.push(e)}return this.oldLightArray=i,i},ReactionGrid.prototype.getRandomHex=function(){console.log("getRandomHex");for(var i=Array.from(this.pixTable.keys()),t=[],e=0;e<i.length;e++){var r=this.pixTable.get(i[e]);if(null!=r)if(r.enabled)r.script.pixTile.isDefault()&&t.push(r)}var n=CreateRandomNumber(0,t.length);return console.log("keyIndex = "+n),t[n]},ReactionGrid.prototype.createRandomOrderNew=function(i){for(var t=Array.from(this.pixTable.keys()),e=t[CreateRandomNumber(0,t.length)],r=[],n=0;n<i;n++){if(r.length>=i)return console.log("path.length is larger than length"),r;var a;if(0==(a=this.getHexNeighbors(e)).length)return this.hasBeen=[],r;var o=CreateRandomNumber(0,a.length);if(this.arrayContains(this.hasBeen,a[o])){for(;0<a.length;n++)if(o=n,!this.arrayContains(this.hasBeen,a[o])){var s;if(s=this.pixTable.get(a[o])){var h=s.script.pixTile;h&&!h.specialHex&&r.push(s)}break}}else(s=this.pixTable.get(a[o]))&&r.push(s);this.hasBeen.push(e),e=a[o]}return this.hasBeen=[],r},ReactionGrid.prototype.getHexNeighbors=function(i){var t=[];if(null!=i)for(var e=i.split(","),r=parseInt(e[0]),n=parseInt(e[1]),a=parseInt(e[2]),o=-1;o<=1;o++)for(var s=-1;s<=1;s++)for(var h=-1;h<=1;h++){if(0!=o||0!=s||0!=h)if(r+o+(n+s)+(a+h)==0){var p=new Hex(r+o,n+s,a+h);p=hex_to_string(p);var c=this.pixTable.get(p);null!=c&&c.enabled&&t.push(p)}}return t};var GameUtilities=pc.createScript("gameUtilities");GameUtilities.attributes.add("pickAreaScale",{type:"number",title:"Pick Area Scale",description:"1 is more accurate but worse performance. 0.01 is best performance but least accurate. 0.25 is the default.",default:.25,min:.01,max:1}),GameUtilities.attributes.add("layerNames",{type:"string",title:"Layers Names",array:!0,description:"Layer names from which objects will be picked from.",default:["World"]}),GameUtilities.attributes.add("camera",{type:"entity",default:null,title:"Camera Entity"}),GameUtilities.prototype.initialize=function(){var e=this.app.graphicsDevice.canvas,t=parseInt(e.clientWidth,10),a=parseInt(e.clientHeight,10);this.picker=new pc.Picker(this.app,t*this.pickAreaScale,a*this.pickAreaScale),this.layers=[];for(var i=0;i<this.layerNames.length;++i){var r=this.app.scene.layers.getLayerByName(this.layerNames[i]);r&&this.layers.push(r)}},GameUtilities.prototype.getEntityAtScreenPos=function(e,t){var a=this.app.graphicsDevice.canvas,i=parseInt(a.clientWidth,10),r=parseInt(a.clientHeight,10),c=this.camera.camera,s=this.app.scene,n=this.picker;n.resize(i*this.pickAreaScale,r*this.pickAreaScale),n.prepare(c,s,this.layers);var l=Math.floor(e.x*(n.width/i)),p=n.height-Math.floor(e.y*(n.height/r)),o=n.getSelection({x:l,y:p});if(o.length>0&&o[0]&&o[0].node){for(var h=o[0].node;!(null===h||h instanceof pc.Entity&&h.script&&h.script[t]);)h=h.parent,console.log(h.script[t]);if(h)return h}return null},GameUtilities.prototype.getLinePlaneIntersection=function(e,t,a,i){var r=(new pc.Vec3).sub2(t,e),c=i.dot(r);if(Math.abs(c)>1e-6){var s=(new pc.Vec3).sub2(e,a),n=-i.dot(s)/c;return r.mulScalar(n),(new pc.Vec3).add2(e,r)}return null},GameUtilities.prototype.calculateScreenPosOnPlane=function(e,t,a){var i=this.camera.camera.screenToWorld(e.x,e.y,this.camera.camera.nearClip),r=this.camera.camera.screenToWorld(e.x,e.y,this.camera.camera.farClip);return this.getLinePlaneIntersection(i,r,t,a)},GameUtilities.prototype.calculateScreenPosOnOrigoPlane=function(e){return this.calculateScreenPosOnPlane(e,new pc.Vec3(0,0,0),new pc.Vec3(0,1,0))};var GameLogics=pc.createScript("gameLogics");GameLogics.attributes.add("pixGridEntity",{type:"entity",default:null,title:"Pix Grid Entity"}),GameLogics.attributes.add("inspectModeEntity",{type:"entity",default:null,title:"Inspect Mode Entity"}),GameLogics.attributes.add("buildModeEntity",{type:"entity",default:null,title:"Build Mode Entity"}),GameLogics.attributes.add("moveModeEntity",{type:"entity",default:null,title:"Move Mode Entity"}),GameLogics.attributes.add("dronepPlacerModeEntity",{type:"entity",default:null,title:"DronePlacer Mode Entity"}),GameLogics.attributes.add("pickWasteEntity",{type:"entity",default:null,title:"pick Waste Entity"}),GameLogics.attributes.add("wastePerSecond",{type:"number",default:1,title:"Waste accumulated per second"}),GameLogics.prototype.initialize=function(){this.isCursorInScreen=!0,this.inspectedPixName="",this.totalWasteCollected=0},GameLogics.prototype.resetMode=function(){this.moveModeEntity.enabled=!1,this.buildModeEntity.enabled=!1,this.dronepPlacerModeEntity.enabled=!1,this.inspectedPixName="",this.deHighlightAllPixLocations()},GameLogics.prototype.activateMoveMode=function(){this.resetMode(),this.moveModeEntity.enabled=!0,console.log("Move mode activated")},GameLogics.prototype.activateBuildMode=function(){this.resetMode(),this.buildModeEntity.enabled=!0},GameLogics.prototype.activateInspectMode=function(){this.resetMode(),console.log("Inspect mode activated")},GameLogics.prototype.activateDronePlacingMode=function(){this.resetMode(),this.dronepPlacerModeEntity.enabled=!0,this.highlightPixWithoutDroneLocations(),console.log("Drone placer activated")},GameLogics.prototype.activateBuildModeWithTier=function(t){this.activateBuildMode()},GameLogics.prototype.update=function(t){this.updateTrashOnPixs(t)},GameLogics.prototype.updateTrashOnPixs=function(t){this.wastePerSecond},GameLogics.prototype.deHighlightAllPixLocations=function(){},GameLogics.prototype.highlightEmptyPixLocations=function(){},GameLogics.prototype.highlightPlacedPixLocations=function(){},GameLogics.prototype.highlightPixWithoutDroneLocations=function(){},GameLogics.prototype.placeDroneOnAllPix=function(){};var PixClicker=pc.createScript("pixClicker"),popUpTextType={PointsToAdd:0,CurrentCombo:1,CurrentPoints:2},onClikedType={Nothing:0,PopUpText:1,Particals:2,PopUpTextAndParticals:3};PixClicker.attributes.add("numberAssests",{type:"asset",array:!0}),PixClicker.attributes.add("toShow",{type:"number",enum:Object.entries(popUpTextType).map((e=>{var t={};return t[e[0]]=e[1],t})),default:1}),PixClicker.attributes.add("onCliked",{type:"number",enum:Object.entries(onClikedType).map((e=>{var t={};return t[e[0]]=e[1],t})),default:1}),PixClicker.attributes.add("maxPoints",{type:"number",default:3}),PixClicker.attributes.add("reactionManagerEntity",{type:"entity",default:0}),PixClicker.attributes.add("inputManagerEntity",{type:"entity",default:0}),PixClicker.attributes.add("gameUtilitiesEntity",{type:"entity",default:0}),PixClicker.attributes.add("pixGridEntity",{type:"entity",default:0}),PixClicker.attributes.add("pickAreaScale",{type:"number",title:"Pick Area Scale",description:"1 is more accurate but worse performance. 0.01 is best performance but least accurate. 0.25 is the default.",default:.25,min:.01,max:1}),PixClicker.attributes.add("layerNames",{type:"string",title:"Layers Names",array:!0,description:"Layer names from which objects will be picked from.",default:["World"]}),PixClicker.attributes.add("camera",{type:"entity",default:null,title:"Camera Entity"}),PixClicker.prototype.initialize=function(){this.gameUtilities=this.gameUtilitiesEntity.script.gameUtilities,this.inputManager=this.inputManagerEntity.script.inputManager,this.reactionGrid=this.pixGridEntity.script.reactionGrid,this.manager=this.reactionManagerEntity.script.reactionManager,this.currentIndex=0;var e=this.app.graphicsDevice.canvas,t=parseInt(e.clientWidth,10),i=parseInt(e.clientHeight,10);this.picker=new pc.Picker(this.app,t*this.pickAreaScale,i*this.pickAreaScale),this.layers=[];for(var a=0;a<this.layerNames.length;++a){var r=this.app.scene.layers.getLayerByName(this.layerNames[a]);r&&this.layers.push(r)}},PixClicker.prototype.update=function(e){if(this.manager.isPlaying){var t=this.inputManager.mouseWasPressedThisFrame,i=(this.inputManager.isMouseDown,this.inputManager.mousePos);if(t&&i){var a=this.getPixEntityAtMousePos();if(null==a)return;if(!a.enabled)return;var r=a.script.pixTile;if(null==r)return;if(r.pixWasCliked)return;var n=new pc.Color(0,0,0,1),s=new pc.Color(1,1,0),o=new pc.Color(.5176470588235295,.8313725490196079,.7372549019607844,1),c=new pc.Color(1,.4,.2784313725490196,1),l=0;switch(r.currentType){case colorMode.Default:"-1",n=c,l=-1,this.manager.resetCombo(),this.manager.updateMissedCount(!1);break;case colorMode.HigheLight:switch(this.manager.increaseCombo(),this.manager.updateMissedCount(!0),this.manager.increaseDecreaseFireMeter(1),n=o,l=this.getPointsToAdd(r),this.toShow){case popUpTextType.PointsToAdd:"+"+l;break;case popUpTextType.CurrentPoints:this.manager.points;break;case popUpTextType.CurrentCombo:this.manager.combo;break;default:console.log("WTF")}break;case colorMode.PressedWrong:"-1",n=c,l=-1,this.manager.resetCombo(),this.manager.updateMissedCount(!1),this.manager.increaseDecreaseFireMeter(-1),this.manager.shakeScreen();break;case colorMode.Bomb:"-10",n=c,l=-10,this.manager.resetCombo(),this.manager.updateMissedCount(!1),this.manager.increaseDecreaseFireMeter(-10),this.manager.shakeScreen();break;case colorMode.Golden:this.manager.increaseCombo(),this.manager.updateMissedCount(!0),this.manager.increaseDecreaseFireMeter(10),"+10",n=s,l=10}if(0==l)return void r.setType(colorMode.Default);var p=this.getAsset(l);switch(console.log("asset = "+p),this.onCliked){case onClikedType.Nothing:break;case onClikedType.PopUpText:p&&this.manager.spawnHitImageAtPos(a.getPosition(),p,n);break;case onClikedType.Particals:this.manager.spawnParticalAtPos(a.getPosition(),r.currentType);break;case onClikedType.PopUpTextAndParticals:p&&this.manager.spawnHitImageAtPos(a.getPosition(),p,n),this.manager.spawnParticalAtPos(a.getPosition(),r.currentType)}r.pixCliked(),this.manager.addPoints(l)}}},PixClicker.prototype.getAsset=function(e){var t=e-1;return this.numberAssests[t]?this.numberAssests[t]:null},PixClicker.prototype.getPointsToAdd=function(e){var t=0;if(null!=e){for(var i=e.maxStayTime/this.maxPoints,a=e.getCurrentTime(),r=0;r<this.maxPoints;r++){a>i*r&&t++}return t}console.log("pixScript is null")},PixClicker.prototype.getEntityAtScreenPos=function(e,t){var i=this.app.graphicsDevice.canvas,a=parseInt(i.clientWidth,10),r=parseInt(i.clientHeight,10),n=this.camera.camera,s=this.app.scene,o=this.picker;o.resize(a*this.pickAreaScale,r*this.pickAreaScale),o.prepare(n,s,this.layers);var c=Math.floor(e.x*(o.width/a)),l=o.height-Math.floor(e.y*(o.height/r)),p=o.getSelection({x:c,y:l});console.log(p.length);var u=null;if(p.length>0&&p[0]&&p[0].node){for(u=p[0].node,console.log("in if statment");!(null===u||u instanceof pc.Entity&&u.script&&u.script[t]);)u=u.parent,console.log("in while loop");if(u)return u}return console.log(u),u},PixClicker.prototype.getLinePlaneIntersection=function(e,t,i,a){var r=(new pc.Vec3).sub2(t,e),n=a.dot(r);if(Math.abs(n)>1e-6){var s=(new pc.Vec3).sub2(e,i),o=-a.dot(s)/n;return r.mulScalar(o),(new pc.Vec3).add2(e,r)}return null},PixClicker.prototype.getPixEntityAtMousePos=function(){var e=this.inputManager.mousePos,t=this.calculateScreenPosOnOrigoPlane(e);if(t){var i=this.reactionGrid.getPixCordFromPosition(t);return this.reactionGrid.getPix(i)}return null},PixClicker.prototype.calculateScreenPosOnPlane=function(e,t,i){var a=this.camera.camera.screenToWorld(e.x,e.y,this.camera.camera.nearClip),r=this.camera.camera.screenToWorld(e.x,e.y,this.camera.camera.farClip);return this.getLinePlaneIntersection(a,r,t,i)},PixClicker.prototype.calculateScreenPosOnOrigoPlane=function(e){return this.calculateScreenPosOnPlane(e,new pc.Vec3(0,.4,0),new pc.Vec3(0,1,0))};var ReactionManager=pc.createScript("reactionManager"),missedPixType={Ignore:0,MinusScore:1,ResetCombo:2,MinusScoreAndResetCombo:3};ReactionManager.attributes.add("toDoMissedPix",{type:"number",enum:Object.entries(missedPixType).map((t=>{var i={};return i[t[0]]=t[1],i})),default:1}),ReactionManager.attributes.add("startUpTime",{type:"number",default:1}),ReactionManager.attributes.add("spawnTime",{type:"number",default:1}),ReactionManager.attributes.add("deSpawnTime",{type:"number",default:1}),ReactionManager.attributes.add("restartGUIEntity",{type:"entity",default:null,title:"restart GUI Entity"}),ReactionManager.attributes.add("onFireBarEntity",{type:"entity",default:null,title:"Progress Bar"}),ReactionManager.attributes.add("onFireBar5SecEntity",{type:"entity",default:null,title:"Progress Bar 5 sec"}),ReactionManager.attributes.add("comboMeterEntity",{type:"entity",default:null,title:"combo Meter Entity"}),ReactionManager.attributes.add("starCounterEntity",{type:"entity",default:null,title:"Star Bar"}),ReactionManager.attributes.add("startCountDownTimerEntity",{type:"entity",default:null,title:"start Count Down Timer Entity"}),ReactionManager.attributes.add("hitEntity",{type:"entity",default:null}),ReactionManager.attributes.add("hitAmount",{type:"number",default:10}),ReactionManager.attributes.add("markerUpTime",{type:"number",default:.2}),ReactionManager.attributes.add("markerSpeed",{type:"number",default:1}),ReactionManager.attributes.add("maxMissAmount",{type:"number",default:3}),ReactionManager.attributes.add("backgroundEntity",{type:"entity",default:null,title:"start Count Down Timer Entity"}),ReactionManager.prototype.resetMissedCountArray=function(){this.missedCountArray=[];for(var t=0;t<this.maxMissAmount;t++)this.missedCountArray.push(!0)},ReactionManager.prototype.initialize=function(){this.shouldSpawnGoldenHexNextPossibleFrame=!1,this.onFireMeter=0,this.maxOnFireMeter=0,this.queue=[],this.queueTimes=[],this.time=0,this.screenUIManager=this.entity.script.screenUIManager,this.screenUIManager.showStartUpTime(),this.oldNumber=0,this.currentMiss=this.maxMissAmount,this.resetMissedCountArray(),this.particalsSettings=this.entity.script.particalsSettings,this.lifeTime=this.particalsSettings.lifeTime,this.particalSpawnLength=this.particalsSettings.particalSpawnLength,this.particalEntity=this.particalsSettings.particalEntity,this.particalGoldenEntity=this.particalsSettings.particalGoldenEntity,this.particalWrongEntity=this.particalsSettings.particalWrongEntity,this.particalSpawnGoldenEntity=this.particalsSettings.particalSpawnGoldenEntity,this.currentMultiplierIndex=-1,this.createUIHits(),this.createParticalHits(),this.pixHieLighted=0,this.gridSettings=this.entity.script.gridSettings,this.endRingSize=this.gridSettings.endRingSize,this.startRingSize=this.gridSettings.startRingSize,this.maxTime=this.gridSettings.maxTime,this.arraySettings=this.entity.script.arraySettings,this.shouldDeacreaseTime=this.arraySettings.shouldDeacreaseTime,this.decreaseDelay=this.arraySettings.decreaseDelay,this.arrayLength=this.arraySettings.arrayLength,this.useNearestNeigbor=this.arraySettings.useNearestNeigbor,this.highLightPixDelay=this.arraySettings.highLightPixDelay,this.spawnArrayDelay=this.arraySettings.spawnArrayDelay,this.reactionGridEntity=this.arraySettings.reactionGridEntity,this.amountMultiplier=[],this.multiplierMilestone=[],this.comboMultiplierSettings=this.entity.script.comboMultiplierSettings,this.difficultiesPhases=this.comboMultiplierSettings.difficultiesPhases;for(var t=this.comboMultiplierSettings.multiplierMilestone.length,i=0;i<t;i++)this.amountMultiplier.push(this.comboMultiplierSettings.amountMultiplier[i]),this.multiplierMilestone.push(this.comboMultiplierSettings.multiplierMilestone[i]);this.maxSpecialHexSpawnAmount=t,this.specialHexIndex=0,this.specialHexSpawnAmount=0,this.oldMultiplayIndex=0,this.reactionGrid=this.reactionGridEntity.script.reactionGrid,this.reactionGrid.nrOfRings=this.startRingSize,this.reactionGrid.currentNumberOfRings=this.startRingSize,this.timeBetweenPhases=this.maxTime/this.difficultiesPhases,this.currentTimePhase=0,this.currentPhase=1,this.spawnHexagons=!0,this.higeLightTimer=0,this.hightLightArray=[],this.hightLightIndex=0,this.currentStartUpTime=this.startUpTime,this.allPix=[],this.combo=0,this.maxCombo=0,this.points=0,this.multiplier=1,this.isPlaying=!1,this.gameIsOver=!1,this.currentSpawnTime=this.spawnTime,this.currentDeSpawnTime=0,this.spawnContinually&&(this.spawnArrayDelay=this.spawnTime/10),this.currentArrayTime=this.spawnArrayDelay,this.currentTimer=this.maxTime,this.hightLightOrder=!1,this.tempTimer=4,this.originalHighLightPixDelay=this.highLightPixDelay,this.originalDeSpawnTime=this.deSpawnTime,this.entity.sound&&this.doOnce&&this.entity.sound.play("backgroundSound")},ReactionManager.prototype.update=function(t){if(this.setGoldenParticalPosition(),this.allPix=this.reactionGrid.getAllPixAsArray(),this.time+=t,this.updateMarkers(t),this.currentStartUpTime-=t,this.currentStartUpTime<=0&&!this.isPlaying&&!this.gameIsOver&&(this.startCountDownTimerEntity.enabled=!1,this.screenUIManager.showStartUpTime(),this.multiplier=0,this.combo=0,this.isPlaying=!0),this.isPlaying){this.currentTimePhase+=t,this.startCountDownTimerEntity.enabled=!1,this.currentTimePhase>this.timeBetweenPhases&&this.currentPhase<=this.difficultiesPhases&&(this.currentPhase++,this.currentTimePhase=0,this.reactionGrid.currentNumberOfRings++,this.reactionGrid.currentNumberOfRings=Clamp(this.reactionGrid.currentNumberOfRings,this.startRingSize,this.endRingSize),this.reactionGrid.increaseGridSize(),this.shouldDeacreaseTime&&(this.highLightPixDelay-=this.decreaseDelay,this.highLightPixDelay=Clamp(this.highLightPixDelay,0,this.highLightPixDelay+this.decreaseDelay),this.deSpawnTime-=.3,this.deSpawnTime=Clamp(this.deSpawnTime,0,10))),this.higeLightTimer-=t,this.isPlaying&&this.spawnHexagons&&this.highLightOrder(),this.currentTimer-=t;var i=Math.floor(this.currentTimer);if(i/5<=1&&i!=this.oldNumber&&i>0&&(this.oldNumber=i,this.entity.sound&&this.entity.sound.play("countDownSound")),this.currentTimer-this.deSpawnTime<0&&!this.gameIsOver){this.spawnHexagons=!1;for(var e=!1,r=0;r<this.allPix.length;r++)this.allPix[r].script.pixTile.canBeClicked()&&(e=!0);e||(this.gameOver(),this.screenUIManager.showRestartUi(),this.isPlaying=!1)}else{if(this.restartGUIEntity.enabled=!1,this.tempTimer-=t,this.tempTimer<=0){for(var s=this.reactionGrid.getRandomHex();ArrayContains(s,this.hightLightArray);)s=this.reactionGrid.getRandomHex();if(null==s)return void console.log("entity is null");if(!s.enabled)return void console.log("entity is not enabled");if(!s.script.pixTile.isDefault())return void console.log("entity is not Default");s.script.pixTile.higeLightType(colorMode.Bomb,this.deSpawnTime),console.log("bomb"),this.tempTimer=4}this.updateMissedPix(),this.comboMeterEntity.script.progressBar.setTargetValue(this.getComboSliderPercent())}}},ReactionManager.prototype.highLightOrder=function(){var t=null;if(this.shouldSpawnGoldenHexNextPossibleFrame){for(var i=this.reactionGrid.getRandomHex();ArrayContains(i,this.hightLightArray);)i=this.reactionGrid.getRandomHex();if(null==i)return void(this.shouldSpawnGoldenHexNextPossibleFrame=!0);i.enabled=!0,(t=i.script.pixTile).higeLightType(colorMode.Golden,this.deSpawnTime),this.increaseDecreaseFireMeter(10,"Max"),this.specialHexSpawnAmount++,this.specialHexIndex++,this.shouldSpawnGoldenHexNextPossibleFrame=!1}if(null==this.hightLightArray||0==this.hightLightArray.length)return this.hightLightArray=[],void(this.hightLightArray=this.createNewPath());if(this.higeLightTimer<=0){this.higeLightTimer=this.highLightPixDelay;var e=this.hightLightArray[this.hightLightIndex];if(null==e)return void(this.hightLightArray=[]);if(null==(t=e.script.pixTile))return;if(!t.isDefault())return this.hightLightArray=[],void(this.hightLightArray=this.createNewPath());t.higeLightType(colorMode.HigheLight,this.deSpawnTime),this.increaseDecreaseFireMeter(1,"Max"),this.pixHieLighted++,this.hightLightIndex++}this.hightLightIndex>=this.hightLightArray.length&&(this.hightLightIndex=0,this.hightLightArray=[],this.hightLightArray=this.createNewPath())},ReactionManager.prototype.reset=function(){this.currentStartUpTime=this.startUpTime,this.screenUIManager.showStartUpTime(),this.resetCombo(),this.maxCombo=0,this.onFireMeter=0,this.maxOnFireMeter=0,this.queue=[],this.queueTimes=[],this.resetMultiplier(),this.points=0,this.isPlaying=!1,this.gameIsOver=!1,this.reactionGrid&&this.reactionGrid.resetAll(),this.spawnContinually&&(this.spawnArrayDelay=this.spawnTime/10),this.currentTimer=this.maxTime+1,this.currentDeSpawnTime=0,this.spawnHexagons=!0,this.currentSpawnTime=this.spawnTime,this.currentArrayTime=this.spawnArrayDelay,this.reactionGrid.currentNumberOfRings=this.startRingSize,this.currentPhase=1,this.currentTimePhase=0,this.reactionGrid.resetGrid(),this.hightLightArray=this.reactionGrid.createRandomOrderNew(this.arrayLength),this.highLightPixDelay=this.originalHighLightPixDelay,this.deSpawnTime=this.originalDeSpawnTime,this.specialHexIndex=0,this.specialHexSpawnAmount=0,this.oldMultiplayIndex=0},ReactionManager.prototype.addPoints=function(t){if(this.isPlaying){for(var i=0;i<this.multiplierMilestone.length;i++)this.multiplierMilestone[i]<=this.combo&&(this.multiplier=this.amountMultiplier[i],this.currentMultiplierIndex=i,this.entity.sound&&this.oldMultiplayIndex<this.currentMultiplierIndex&&this.entity.sound.play("comboSound"));var e=this.oldMultiplayIndex<this.currentMultiplierIndex,r=this.specialHexSpawnAmount<this.maxSpecialHexSpawnAmount,s=this.specialHexIndex<this.currentMultiplierIndex;if(e&&r&&s){this.oldMultiplayIndex=this.currentMultiplierIndex;for(var a=this.reactionGrid.getRandomHex();ArrayContains(a,this.hightLightArray);)a=this.reactionGrid.getRandomHex();if(null==a)return void(this.shouldSpawnGoldenHexNextPossibleFrame=!0);a.enabled=!0,a.script.pixTile.higeLightType(colorMode.Golden,this.deSpawnTime),this.increaseDecreaseFireMeter(10,"Max"),this.specialHexSpawnAmount++,this.specialHexIndex++}this.oldMultiplayIndex=this.currentMultiplierIndex,this.points+=t;this.points=Clamp(this.points,0,1e3)}else console.log("Return")},ReactionManager.prototype.updateMarkers=function(t){if(0!=this.hitTextEntityArray.length)for(var i=0;i<this.hitTextEntityArray.length;i++){var e=this.hitTextEntityArray[i];if(null!=e&&e.enabled){var r=e.getPosition().clone();r.z-=t*this.markerSpeed,e.setPosition(r);var s=e.script.hitMarker;null!=s&&(s.spawnedTime-=t,s.spawnedTime<=0&&(s.spawnedTime=this.markerUpTime,e.enabled=!1))}}else console.log("hit Entity Length is = "+this.hitTextEntityArray.length)},ReactionManager.prototype.spawnHitMarkerAtPos=function(t,i,e){if(0==this.hitTextEntityArray.length)return console.log("hit Entity Length is = "+this.hitTextEntityArray.length),!1;for(var r="no index",s=1;s<this.hitTextEntityArray.length;s++)if(null!=this.hitTextEntityArray[s]&&!this.hitTextEntityArray[s].enabled)return r=s,this.hitTextEntityArray[s].setPosition(t),this.hitTextEntityArray[s].enabled=!0,this.hitTextEntityArray[s].element._type=pc.ELEMENTTYPE_TEXT,void(this.hitTextEntityArray[s].element.text=i);console.log("index = "+r)},ReactionManager.prototype.spawnHitImageAtPos=function(t,i,e){if(0==this.hitTextEntityArray.length)return console.log("hit Entity Length is = "+this.hitTextEntityArray.length),!1;for(var r="no index",s=1;s<this.hitTextEntityArray.length;s++)if(null!=this.hitTextEntityArray[s]&&!this.hitTextEntityArray[s].enabled)return r=s,this.hitTextEntityArray[s].setPosition(t),this.hitTextEntityArray[s].enabled=!0,this.hitTextEntityArray[s].element._type=pc.ELEMENTTYPE_IMAGE,void(this.hitTextEntityArray[s].element.textureAsset=i);console.log("index = "+r)},ReactionManager.prototype.createUIHits=function(){this.hitTextEntityArray=[];for(var t=0;t<this.hitAmount;t++){var i=this.hitEntity.clone();i.enabled=!1,i.name=i.name+"_"+t,this.entity.addChild(i),this.hitTextEntityArray.push(i)}},ReactionManager.prototype.spawnParticalAtPos=function(t,i){if(0==this.hitParticalEntityArray.length)return console.log("hit Entity Length is = "+this.hitParticalEntityArray.length),!1;for(var e=0;e<this.particalSpawnLength;e++){var r;switch(i){case colorMode.HigheLight:r=this.hitParticalEntityArray[e];break;case colorMode.Golden:r=this.hitParticalGoldenArray[e];break;default:r=this.hitParticalWrongArray[e]}if(null!=r)if(!r.enabled)return r.setPosition(t.add(pc.Vec3.UP)),r.enabled=!0,void r.script.particalScript.startPlaying(this.lifeTime)}return!1},ReactionManager.prototype.createParticalHits=function(){this.hitParticalEntityArray=[],this.hitParticalGoldenArray=[],this.hitParticalWrongArray=[];for(var t=0;t<this.particalSpawnLength;t++){var i=this.particalEntity.clone();i.enabled=!1,i.name=i.name+"_"+t,this.entity.addChild(i),this.hitParticalEntityArray.push(i);var e=this.particalGoldenEntity.clone();e.enabled=!1,e.name=e.name+"_"+t,this.entity.addChild(e),this.hitParticalGoldenArray.push(e);var r=this.particalWrongEntity.clone();r.enabled=!1,r.name=r.name+"_"+t,this.entity.addChild(r),this.hitParticalWrongArray.push(r)}this.particalSpawnGoldenClone=this.particalSpawnGoldenEntity.clone(),this.particalSpawnGoldenClone.enabled=!1,this.entity.addChild(this.particalSpawnGoldenClone)},ReactionManager.prototype.updateMissedPix=function(){for(var t=null,i=0;i<this.allPix.length;i++)switch(this.toDoMissedPix){case missedPixType.Ignore:(t=this.allPix[i].script.pixTile).pixWasMissed&&(t.pixWasMissed=!1,this.increaseDecreaseFireMeter(-2));break;case missedPixType.MinusScore:(t=this.allPix[i].script.pixTile).pixWasMissed&&(this.missedPix(),t.pixWasMissed=!1,this.increaseDecreaseFireMeter(-2));break;case missedPixType.ResetCombo:(t=this.allPix[i].script.pixTile).pixWasMissed&&(this.updateMissedCount(!1),t.pixWasMissed=!1,this.increaseDecreaseFireMeter(-2));break;case missedPixType.MinusScoreAndResetCombo:(t=this.allPix[i].script.pixTile).pixWasMissed&&(this.missedPix(),this.updateMissedCount(!1),t.pixWasMissed=!1,this.increaseDecreaseFireMeter(-2))}ArrayContains(!0,this.missedCountArray)||(this.resetCombo(),this.resetMissedCountArray(),this.shakeScreen())},ReactionManager.prototype.setGoldenParticalPosition=function(){},ReactionManager.prototype.shakeScreen=function(){this.backgroundEntity.script.shackeBackground.startScreenShake()},ReactionManager.prototype.updateMissedCount=function(t){for(var i=this.missedCountArray.length-1,e=1;e<this.maxMissAmount;e++){var r=e-1;this.missedCountArray[r]=this.missedCountArray[e]}this.missedCountArray[i]=t,this.addToQueue(t)},ReactionManager.prototype.addToQueue=function(t){for(var i=[],e=[],r=0;r<this.queueTimes.length;r++)this.time-this.queueTimes[r]<5&&(e.push(this.queueTimes[r]),i.push(this.queue[r]));if(this.queueTimes=e,this.queue=i,this.time-this.queueTimes[0]>5){for(var s=1;s<this.queueTimes.length;s++)this.queueTimes[s-1]=this.queueTimes[s],this.queue[s-1]=this.queue[s];this.queue[this.queueTimes.length]=t,this.queueTimes[this.queueTimes.length]=this.time}else this.queue.push(t),this.queueTimes.push(this.time);for(var a=this.queueTimes.length,n=0;n<this.queueTimes.length;n++)this.queue[n]||a--;this.onFireBar5SecEntity.script.progressBar.setTargetValue(a/this.queueTimes.length)},ReactionManager.prototype.missedPix=function(){this.points-=1,this.points=Clamp(this.points,0,this.points+1)},ReactionManager.prototype.addComboToScore=function(){this.points+=this.multiplier*this.combo},ReactionManager.prototype.createNewPath=function(){return this.useNearestNeigbor?this.reactionGrid.createRandomOrderNew(this.arrayLength):this.reactionGrid.createRandomOrder(this.arrayLength)},ReactionManager.prototype.getTotalPoints=function(){return parseInt(this.points)},ReactionManager.prototype.getTime=function(){return Clamp(parseInt(this.currentTimer),0,this.maxTime)},ReactionManager.prototype.getCurrentStartTime=function(){return parseInt(this.currentStartUpTime)},ReactionManager.prototype.increaseCombo=function(){this.combo++,this.combo>this.maxCombo&&(this.maxCombo=this.combo)},ReactionManager.prototype.getMaxCombo=function(){return this.maxCombo},ReactionManager.prototype.resetCombo=function(){this.combo=0,this.entity.sound&&this.entity.sound.play("lostComboSound")},ReactionManager.prototype.getCombo=function(){return this.combo},ReactionManager.prototype.getComboString=function(){return this.combo<=0?"":"COMBO "+this.combo},ReactionManager.prototype.getMultiplier=function(){return this.multiplier},ReactionManager.prototype.getMultiplierString=function(){if(0==this.multiplier||1==this.multiplier)return"";var t=["\nGODSPEED !","\nSTELLAR!","\nALPHA!","\nMOON!","\nWagmi!"],i=Clamp(this.currentMultiplierIndex,0,t.length-1);return"X "+this.multiplier+t[i]},ReactionManager.prototype.resetMultiplier=function(){this.multiplier=1},ReactionManager.prototype.resetPoints=function(){this.points=0},ReactionManager.prototype.gameOver=function(){var t=this.onFireMeter/this.maxOnFireMeter,i=Math.floor(5*t);this.starCounterEntity.script.starCounter.showStars(i),this.addComboToScore(),this.resetCombo(),this.resetMultiplier(),this.gameIsOver=!0},ReactionManager.prototype.increaseDecreaseFireMeter=function(t,i){"Max"==i&&t>0?this.maxOnFireMeter+=t:this.onFireMeter+=t,this.onFireMeter=Clamp(this.onFireMeter,0,this.maxOnFireMeter),this.onFireBarEntity.script.progressBar.setTargetValue(this.onFireMeter/this.maxOnFireMeter)},ReactionManager.prototype.getFireMeterString=function(){return this.onFireMeter},ReactionManager.prototype.getMaxFireMeterString=function(){return this.maxOnFireMeter},ReactionManager.prototype.getComboSliderPercent=function(){return(this.combo+this.onFireMeter)/(this.multiplierMilestone[this.multiplierMilestone.length-1]+.7*this.maxOnFireMeter)};var ReactionPix=pc.createScript("reactionPix"),reactionPixType={Off:0,Normal:1,Golden:2,Bomb:3};ReactionPix.attributes.add("maxTime",{type:"number",default:3,title:"max Stay time"}),ReactionPix.attributes.add("pinHitSound",{type:"asset",default:0}),ReactionPix.attributes.add("renderEntity",{type:"entity",default:null}),ReactionPix.attributes.add("usePulse",{type:"boolean",default:!1}),ReactionPix.prototype.initialize=function(){this.reactionManager=null,this.maxPoints=3,this.type=reactionPixType.Off,this.currentTime=0,this.canBeClicked=!1,this.goldenHex=!1,this.bombHex=!1,this.wasBomb=!1,this.originSize=this.entity.getScale().x,this.currentSize=this.originSize,this.timer=0,this.doOnce=!1,this.missed=!1},ReactionPix.prototype.setRenderer=function(t){console.log("setRenderer entity "+t.name),t&&(this.shaderScript=t.script.higeLightEntity),t&&null==this.shaderScript&&(this.shaderScript=t.script.testHightLightShader)},ReactionPix.prototype.update=function(t){this.shaderScript.special=this.goldenHex,this.shaderScript.bomb=this.bombHex;if(this.pulse&&this.usePulse){this.timer+=10*t;var i=.25*Math.sin(this.timer);this.currentSize=this.originSize+i,this.currentSize<this.originSize&&(this.currentSize=this.originSize,this.pulse=!1,this.timer=0)}this.entity.setLocalScale(this.currentSize,this.currentSize,this.currentSize),(this.shaderScript.wrongHightLight||this.shaderScript.rightHightLight)&&(this.currentTime-=t,this.currentTime<=0&&(this.wasBomb=this.bombHex,this.deHightLight(),this.currentTime=this.maxTime,this.canBeClicked=!1,this.bombHex=!1,this.goldenHex=!1,this.missed=!0))},ReactionPix.prototype.selected=function(){this.entity.sound&&this.entity.sound.play("Clicked"),this.shaderScript.selected(),this.currentTime=0,this.canBeClicked=!1,this.pulse=!0,this.pulseTimer=0,this.goldenHex=!1,this.bombHex=!1},ReactionPix.prototype.getPointsToAdd=function(){for(var t=0,i=this.maxTime/this.maxPoints,e=0;e<this.maxPoints;e++)console.log("currentTime = "+this.currentTime),console.log("timeDiff * i = "+i*e),this.currentTime>i*e&&t++;return console.log("pointsToAdd = "+t),t},ReactionPix.prototype.isHightLighted=function(){return this.shaderScript.hightLight},ReactionPix.prototype.pressedWrong=function(){this.shaderScript.pressedWrong(),console.log("pressedWrong")},ReactionPix.prototype.setManager=function(t){this.reactionManager=t.script.reactionManager},ReactionPix.prototype.hightLightGoldenHex=function(t){this.maxTime=t,this.shaderScript.hightLightGoldenHex(this.maxTime),this.goldenHex=!0,this.bombHex=!1,this.wasBomb=!1,this.currentTime=this.maxTime,this.canBeClicked=!0,this.shaderScript.time=0,this.type=reactionPixType.Golden},ReactionPix.prototype.hightLightBombHex=function(t){this.maxTime=t,this.shaderScript.hightLightBombHex(this.maxTime),this.currentTime=this.maxTime,this.canBeClicked=!0,this.bombHex=!0,this.goldenHex=!1,this.shaderScript.time=0,this.type=reactionPixType.Bomb},ReactionPix.prototype.hightLight=function(t){this.maxTime=t,this.shaderScript.hightLight(this.maxTime),this.goldenHex=!1,this.bombHex=!1,this.wasBomb=!1,this.currentTime=this.maxTime,this.canBeClicked=!0,this.shaderScript.time=0,this.type=reactionPixType.Normal},ReactionPix.prototype.deHightLight=function(){this.shaderScript.rightHightLight=!1,this.shaderScript.wrongHightLight=!1,this.canBeClicked=!1,this.shaderScript.deHightLight()},ReactionPix.prototype.getCurrentTime=function(){return this.currentTime};"use strict";function Point(n,e){return{x:n,y:e}}function Hex(n,e,t){return{q:n,r:e,s:t}}function hex_to_string(n){return n.q.toString()+", "+n.r.toString()+", "+n.s.toString()}function string_to_hex(n){let e=n.split(",");return new Hex(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]))}function HexAxial(n,e){return{q:n,r:e}}function hex_add(n,e){return new Hex(n.q+e.q,n.r+e.r,n.s+e.s)}function hex_subtract(n,e){return new Hex(n.q-e.q,n.r-e.r,n.s-e.s)}function hex_scale(n,e){return new Hex(n.q*e,n.r*e,n.s*e)}var hex_directions=[new Hex(1,-1,0),new Hex(1,0,-1),new Hex(0,1,-1),new Hex(-1,1,0),new Hex(-1,0,1),new Hex(0,-1,1)];function hex_direction(n){return hex_directions[n]}function hex_neighbor(n,e){return hex_add(n,hex_direction(e))}function hex_neighbors(n){for(var e=[],t=0;t<6;t++){var r=hex_add(n,hex_direction(t));e.push(r)}return e}var hex_diagonals=[new Hex(1,-2,1),new Hex(2,-1,-1),new Hex(1,1,-2),new Hex(-1,2,-1),new Hex(-2,1,1),new Hex(-1,-1,2)];function hex_diagonal_neighbor(n,e){return hex_add(n,hex_diagonals[e])}function hex_length(n){return Math.trunc((Math.abs(n.q)+Math.abs(n.r)+Math.abs(n.s))/2)}function hex_distance(n,e){return hex_length(hex_subtract(n,e))}function hex_round(n){var e=Math.trunc(Math.round(n.q)),t=Math.trunc(Math.round(n.r)),r=Math.trunc(Math.round(n.s)),o=Math.abs(e-n.q),i=Math.abs(t-n.r),a=Math.abs(r-n.s);return o>i&&o>a?e=-t-r:i>a?t=-e-r:r=-e-t,new Hex(e,t,r)}function hex_lerp(n,e,t){return new Hex(n.q*(1-t)+e.q*t,n.r*(1-t)+e.r*t,n.s*(1-t)+e.s*t)}function hex_linedraw(n,e){for(var t=hex_distance(n,e),r=new Hex(n.q+1e-6,n.r+1e-6,n.s-2e-6),o=new Hex(e.q+1e-6,e.r+1e-6,e.s-2e-6),i=[],a=1/Math.max(t,1),u=0;u<=t;u++)i.push(hex_round(hex_lerp(r,o,a*u)));return i}function cube_to_axial(n){return new HexAxial(n.q,n.s)}function axial_to_cube(n){return new Hex(n.q,-n.q-n.r,n.r)}function OffsetCoord(n,e){return{col:n,row:e}}var EVEN=1,ODD=-1;function qoffset_from_cube(n,e){return new OffsetCoord(e.q,e.r+Math.trunc((e.q+n*(1&e.q))/2))}function qoffset_to_cube(n,e){var t=e.col,r=e.row-Math.trunc((e.col+n*(1&e.col))/2);return new Hex(t,r,-t-r)}function roffset_from_cube(n,e){return new OffsetCoord(e.q+Math.trunc((e.r+n*(1&e.r))/2),e.r)}function roffset_to_cube(n,e){var t=e.col-Math.trunc((e.row+n*(1&e.row))/2),r=e.row;return new Hex(t,r,-t-r)}function Orientation(n,e,t,r,o,i,a,u,x){return{f0:n,f1:e,f2:t,f3:r,b0:o,b1:i,b2:a,b3:u,start_angle:x}}function Layout(n,e,t){return{orientation:n,size:e,origin:t}}var layout_pointy=new Orientation(Math.sqrt(3),Math.sqrt(3)/2,0,1.5,Math.sqrt(3)/3,-1/3,0,2/3,.5),layout_flat=new Orientation(1.5,0,Math.sqrt(3)/2,Math.sqrt(3),2/3,0,-1/3,Math.sqrt(3)/3,0);function hex_to_pixel(n,e){var t=n.orientation,r=n.size,o=n.origin,i=(t.f0*e.q+t.f1*e.r)*r.x,a=(t.f2*e.q+t.f3*e.r)*r.y;return new Point(i+o.x,a+o.y)}function pixel_to_hex(n,e){var t=n.orientation,r=n.size,o=n.origin,i=new Point((e.x-o.x)/r.x,(e.y-o.y)/r.y),a=t.b0*i.x+t.b1*i.y,u=t.b2*i.x+t.b3*i.y;return new Hex(a,u,-a-u)}function hex_corner_offset(n,e){var t=n.orientation,r=n.size,o=2*Math.PI*(e+t.start_angle)/6;return new Point(r.x*Math.cos(o),r.y*Math.sin(o))}function polygon_corners(n,e){for(var t=[],r=hex_to_pixel(n,e),o=0;o<6;o++){var i=hex_corner_offset(n,o);t.push(new Point(r.x+i.x,r.y+i.y))}return t}function ReflectionVector(n,r){var t=n.clone(),e=t.dot(r);return e*=2,r.mulScalar(e),t.sub(r)}function Lerp(n,r,t){return(1-t)*n+r*t}function GetDistanceSquared(n,r){var t=r.x-n.x,e=r.y-n.y,a=r.z-n.z;return t*t+e*e+a*a}function GetLengthSquared(n){return n.x*n.x+n.y*n.y+n.z*n.z}function RandomDirection(){var n=CreateRandomNumber(0,359),r=Math.cos(n),t=Math.sin(n),e=new pc.Vec3(r,t,0);return e.normalize(),console.log("randomDirection = "+e),e}function DoCirclesOverlap(n,r,t,e){return GetDistanceSquared(n,r)>(t+e)*(t+e)}function Clamp(n,r,t){return n=Math.max(r,Math.min(n,t))}function ClampVector(n,r,t){return n.x=Clamp(n.x,r.x,t.x),n.y=Clamp(n.y,r.y,t.y),n.z=Clamp(n.z,r.z,t.z),n}function ClampVectorMagnetude(n,r){var t=n.clone().length(),e=n.clone().normalize();return Math.abs(t)>r&&(n=e.mulScalar(r)),n}function DrawCircle(n,r,t,e){var a,o=[],u=[],c=2*Math.PI/t,i=0;for(a=0;a<t;a++){var l=Math.sin(i),h=Math.cos(i);i+=c;var m=Math.sin(i),s=Math.cos(i);o.push(new pc.Vec3(n.x-r*l,n.y-r*h,n.z+2),new pc.Vec3(n.x-r*m,n.y-r*s,n.z+2)),u.push(e,e)}return[o,u]}function CreateDrawList(n){var r=[],t=[];for(i=0;i<n.length;i++){var e=(i+1)%n.length,a=pc.Color.BLUE;t.push(n[i],n[e]),r.push(a,a)}return[t,r]}function CreateRandomNumber(n,r){var t=r-n;return Math.round(Math.random()*t+n)}function ArrayContains(n,r){var t=!1;for(i=0;i<r.length;i++)n==r[i]&&(t=!0);return t}var ReactionHigeLightPix=pc.createScript("reactionHigeLightPix");ReactionHigeLightPix.prototype.initialize=function(){},ReactionHigeLightPix.prototype.update=function(i){};var CallScriptFunctionOnbuttonPress=pc.createScript("callScriptFunctionOnbuttonPress");CallScriptFunctionOnbuttonPress.attributes.add("scriptEntity",{type:"entity",description:"The entity we want to call a script on"}),CallScriptFunctionOnbuttonPress.attributes.add("scriptName",{type:"string",description:"The name of the script",default:"gameInterface"}),CallScriptFunctionOnbuttonPress.attributes.add("functionName",{type:"string",description:"The name of the function",default:"printLol"}),CallScriptFunctionOnbuttonPress.attributes.add("parameters",{type:"string",description:"parameters to the function",array:!0,default:[]}),CallScriptFunctionOnbuttonPress.prototype.initialize=function(){this.entity.button.on("click",(function(t){this.scriptEntity.script.get(this.scriptName)[this.functionName](this.parameters)}),this)},CallScriptFunctionOnbuttonPress.prototype.update=function(t){};var SetTexToToFunction=pc.createScript("setTextToFunction");SetTexToToFunction.attributes.add("scriptEntity",{type:"entity",description:"The entity we want to call a script on"}),SetTexToToFunction.attributes.add("scriptName",{type:"string",description:"The name of the script",default:"gameInterface"}),SetTexToToFunction.attributes.add("functionName",{type:"string",description:"The name of the function",default:"getLol"}),SetTexToToFunction.prototype.initialize=function(){null==this.scriptEntity&&(this.scriptEntity=this.entity.children[0])},SetTexToToFunction.prototype.update=function(t){this.entity.element.text=this.scriptEntity.script.get(this.scriptName)[this.functionName]()};var SAMPLE_COUNT=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,o,s,r){e[0]=computeGaussian(0,r),t[0]=0,t[1]=0;var i,l,a=e[0];for(i=0,l=Math.floor(SAMPLE_COUNT/2);i<l;i++){var u=computeGaussian(i+1,r);e[2*i]=u,e[2*i+1]=u,a+=2*u;var h=2*i+1.5;t[4*i]=o*h,t[4*i+1]=s*h,t[4*i+2]=-o*h,t[4*i+3]=-s*h}for(i=0,l=e.length;i<l;i++)e[i]/=a}function BloomEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},o=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["precision "+e.precision+" float;","","#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),i=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:s}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:r}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:i}),this.targets=[],this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,BloomEffect.prototype._destroy=function(){var e;if(this.targets)for(e=0;e<this.targets.length;e++)this.targets[e].destroyTextureBuffers(),this.targets[e].destroy();this.targets.length=0},BloomEffect.prototype._resize=function(e){var t,o=e.colorBuffer.width,s=e.colorBuffer.height;if(o!==this.width||s!==this.height)for(this.width=o,this.height=s,this._destroy(),t=0;t<2;t++){var r=new pc.Texture(this.device,{name:"Bloom Texture"+t,format:pc.PIXELFORMAT_R8_G8_B8_A8,width:o>>1,height:s>>1,mipmaps:!1});r.minFilter=pc.FILTER_LINEAR,r.magFilter=pc.FILTER_LINEAR,r.addressU=pc.ADDRESS_CLAMP_TO_EDGE,r.addressV=pc.ADDRESS_CLAMP_TO_EDGE,r.name="pe-bloom";var i=new pc.RenderTarget({name:"Bloom Render Target "+t,colorBuffer:r,depth:!1});this.targets.push(i)}},Object.assign(BloomEffect.prototype,{render:function(e,t,o){this._resize(e);var s=this.device,r=s.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(s,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect),this._destroy()}))};var ToggleEntityEnableOnbuttonPush=pc.createScript("toggleEntityEnableOnbuttonPush");ToggleEntityEnableOnbuttonPush.attributes.add("scriptName",{type:"string",description:"The name of the script",default:"gameInterface"}),ToggleEntityEnableOnbuttonPush.attributes.add("entityToEnable",{type:"entity",description:"entity to enable",default:null}),ToggleEntityEnableOnbuttonPush.prototype.initialize=function(){this.entity.button.on("click",(function(t){this.entityToEnable.enabled=!this.entityToEnable.enabled}),this)},ToggleEntityEnableOnbuttonPush.prototype.update=function(t){};pc.script.attribute("materials","asset",[],{type:"material"}),pc.script.attribute("shader","asset",[],{type:"shader",max:1});var Plasma=pc.createScript("plasma");Plasma.attributes.add("materials",{type:"asset",array:!0}),Plasma.attributes.add("emissiveShader",{type:"asset"}),Plasma.attributes.add("opacityShader",{type:"asset"}),Plasma.prototype.initialize=function(){for(var a=this.emissiveShader.resource,t=this.opacityShader.resource,e=0;e<this.materials.length;e++){var s=this.materials[e].resource;s.chunks.APIVersion=pc.CHUNKAPI_1_55,s.chunks.emissivePS=a,s.chunks.opacityPS=t,s.diffuseMap=new pc.Texture(this.app.graphicsDevice,{width:1,height:1,format:pc.PIXELFORMAT_R8_G8_B8}),s.setParameter("iGlobalTime",0),s.update()}this.time=0},Plasma.prototype.update=function(a){this.time+=a;for(var t=0;t<this.materials.length;t++){this.materials[t].resource.setParameter("iGlobalTime",this.time)}};var EmissivePulse=pc.createScript("emissivePulse");EmissivePulse.attributes.add("useAbs",{type:"boolean",default:!1,title:"use Abs"}),EmissivePulse.attributes.add("pulseSpeed",{type:"number",default:3,title:"Pulse Speed"}),EmissivePulse.attributes.add("pulseRange",{type:"number",default:.5,title:"Pulse Range"}),EmissivePulse.attributes.add("startEmissiveIntensity",{type:"number",default:.5,title:"Start Emissive Intensity"}),EmissivePulse.prototype.initialize=function(){this.t=0},EmissivePulse.prototype.update=function(e){var t=this.entity.render.meshInstances[0].material;this.t+=e*this.pulseSpeed,this.useAbs?t.emissiveIntensity=this.startEmissiveIntensity+Math.abs(Math.sin(this.t)*this.pulseRange):t.emissiveIntensity=this.startEmissiveIntensity+Math.sin(this.t)*this.pulseRange,t.update()};pc.script.attribute("materials","asset",[],{type:"material"});var WriteCameraRendertargetTomaterial=pc.createScript("writeCameraRendertargetTomaterial");WriteCameraRendertargetTomaterial.attributes.add("materials",{type:"asset",array:!0}),WriteCameraRendertargetTomaterial.prototype.initialize=function(){var e=new pc.Texture(this.app.graphicsDevice,{width:1024,height:1024,format:pc.PIXELFORMAT_R8_G8_B8}),t=new pc.RenderTarget({colorBuffer:e,depth:!0});this.entity.camera.renderTarget=t;var a=this.materials[0].resource;a.diffuseMap=e,a.update()},WriteCameraRendertargetTomaterial.prototype.update=function(e){this.entity.camera.enabled=!0};var Rotator=pc.createScript("rotator");Rotator.attributes.add("speed",{type:"number",default:3}),Rotator.prototype.initialize=function(){this.angleX=0,this.angleY=0,this.angleZ=0},Rotator.prototype.update=function(t){this.angleX=3.5*t*this.speed,this.angleY=6.5*t*this.speed,this.angleZ=9.5*t*this.speed,this.entity.rotateLocal(this.angleX,this.angleY,this.angleZ)};var HitMarker=pc.createScript("hitMarker");HitMarker.prototype.initialize=function(){this.spawnedTime=0},HitMarker.prototype.update=function(t){};var GridSettings=pc.createScript("gridSettings");GridSettings.attributes.add("maxTime",{type:"number",default:1}),GridSettings.attributes.add("startRingSize",{type:"number",default:1}),GridSettings.attributes.add("endRingSize",{type:"number",default:1}),GridSettings.prototype.initialize=function(){},GridSettings.prototype.update=function(t){};var HigeLightSettings=pc.createScript("higeLightSettings");HigeLightSettings.prototype.initialize=function(){},HigeLightSettings.prototype.update=function(t){};var ArraySettings=pc.createScript("arraySettings");ArraySettings.attributes.add("shouldDeacreaseTime",{type:"boolean",default:!1}),ArraySettings.attributes.add("decreaseDelay",{type:"number",default:.1}),ArraySettings.attributes.add("arrayLength",{type:"number",default:1}),ArraySettings.attributes.add("useNearestNeigbor",{type:"boolean",default:!1}),ArraySettings.attributes.add("highLightPixDelay",{type:"number",default:.1}),ArraySettings.attributes.add("spawnArrayDelay",{type:"number",default:.1}),ArraySettings.attributes.add("reactionGridEntity",{type:"entity",default:null,title:"reaction Grid Entity"}),ArraySettings.prototype.initialize=function(){},ArraySettings.prototype.update=function(t){};var ComboMultiplierSettings=pc.createScript("comboMultiplierSettings");ComboMultiplierSettings.attributes.add("difficultiesPhases",{type:"number",default:3}),ComboMultiplierSettings.attributes.add("multiplierMilestone",{type:"number",array:!0}),ComboMultiplierSettings.attributes.add("amountMultiplier",{type:"number",array:!0}),ComboMultiplierSettings.prototype.initialize=function(){},ComboMultiplierSettings.prototype.update=function(t){};var world2reflMirror,Mirror=pc.createScript("mirror");Mirror.attributes.add("primitive",{type:"boolean"}),Mirror.attributes.add("density",{type:"number"}),Mirror.attributes.add("onlyTag",{type:"string"}),Mirror.attributes.add("shaderPS",{type:"asset",assetType:"shader"});var planePosWM,planeNormalWM,planeAV,planeBV,planeCV,planeDV,tmpView=new pc.Mat4,tmpView2=new pc.Mat4,tmpView3=new pc.Mat4,planeQ=new pc.Vec4,planeV=new pc.Vec4,planePosV=new pc.Vec3,planeNormalV=new pc.Vec3,projInv=new pc.Mat4,pointsV=[new pc.Vec4,new pc.Vec4,new pc.Vec4,new pc.Vec4],prevGlobalMatrix=new pc.Mat4,tmpQuat=new pc.Quat,mirrorLookAt=new pc.Vec3,localPlayerPos=new pc.Vec3,afterTransitionPos=new pc.Vec3,reflectedCamPos=new pc.Vec3,reflectedCamDir=new pc.Vec3,invPortalPlane=new pc.Vec3,activeMirror=null,mirrorFrustum=new pc.Frustum,tempSphereMirror={center:null,radius:0},mirrorBit=0,atf={},MAX3D_SCALE=1,MIRRORSTATE_FAR=0,MIRRORSTATE_NEAR=1,MIRRORSTATE_TOUCH=2,MIRRORSTATE_SWITCH=3,MIRRORSTATE_POST=4,MIRRORSTATE_OFF=5,mirrorTransition=0,mirrorDefaultFov=0;function reflectionMatrix(e,t,r,a){var i=new pc.Mat4;return i.data[0]=1-2*e*e,i.data[1]=-2*e*t,i.data[2]=-2*e*r,i.data[3]=-2*e*a,i.data[4]=-2*e*t,i.data[5]=1-2*t*t,i.data[6]=-2*t*r,i.data[7]=-2*t*a,i.data[8]=-2*e*r,i.data[9]=-2*t*r,i.data[10]=1-2*r*r,i.data[11]=-2*r*a,i.data[12]=0,i.data[13]=0,i.data[14]=0,i.data[15]=1,i.transpose(),i}function customTransformFuncMirror(e,t){var r=this.node.getPosition(),a=this.node.getRotation();e.setTRS(r,a,pc.Vec3.ONE),e.mul2(world2reflMirror,e)}function customProjFuncMirror(e,t){if(this.projection===pc.PROJECTION_PERSPECTIVE)e.setPerspective(this.fov,this.aspectRatio,this.nearClip,this.farClip,this.horizontalFov);else{var r=0*this.aspectRatio;e.setOrtho(-r,r,-0,0,this.nearClip,this.farClip)}var a=this.node.getPosition(),i=this.node.getRotation();tmpView.setTRS(a,i,pc.Vec3.ONE).invert(),tmpView.transformPoint(planePosWM,planePosV),tmpView.transformVector(planeNormalWM,planeNormalV).normalize(),planeAV=planeNormalV.x,planeBV=planeNormalV.y,planeCV=planeNormalV.z,planeDV=-planePosV.dot(planeNormalV),planeV.set(planeAV,planeBV,planeCV,planeDV),projInv.copy(e).invert(),planeQ.set(sgn(planeAV),sgn(planeBV),1,1),projInv.transformVec4(planeQ,planeQ),planeV.scale(2/planeV.dot(planeQ));var s=e.data;s[2]=planeV.x-s[3],s[6]=planeV.y-s[7],s[10]=planeV.z-s[11],s[14]=planeV.w-s[15]}function sgn(e){return e>0?1:e<0?-1:0}Mirror.prototype.isVisible=function(e){var t,r,a,i=e.frustum,s=this.pointsW,n=e.projectionMatrix;for(i.setFromMat4(n),r=0;r<6;r++){if(t=i.planes[r][0]*s[0].x+i.planes[r][1]*s[0].y+i.planes[r][2]*s[0].z+i.planes[r][3]<=0)for(a=1;a<4;a++)if(i.planes[r][0]*s[a].x+i.planes[r][1]*s[a].y+i.planes[r][2]*s[a].z+i.planes[r][3]>0){t=!1;break}if(t)return!1}return!0},Mirror.prototype.initialize=function(){var e,t,r,a,i=this.app,s=i.graphicsDevice;pc.shaderChunks;this.cam=i.root.findByName("Camera").camera,this.nearDist=3;var n=this.entity.render.meshInstances[0],o=atf.mirrorRt;if(!o){var p=n.material;p.customFragmentShader=this.shaderPS.resource,p.blendType=pc.BLEND_NORMAL,p.update(),pc.mirrorMaterial=p,pc.fallbackMirrorMaterial=p.clone(),this.setSky(2);var c=pc.PIXELFORMAT_R8_G8_B8_A8;s.webgl2&&s.extTextureFloatRenderable?c=pc.PIXELFORMAT_111110F:s.extTextureHalfFloatRenderable&&s.extTextureHalfFloatLinear&&(c=pc.PIXELFORMAT_RGBA16F);var l=new pc.Texture(s,{width:s.width,height:s.height,format:c,autoMipmap:!1});l.addressU=pc.ADDRESS_CLAMP_TO_EDGE,l.addressV=pc.ADDRESS_CLAMP_TO_EDGE,l.magFilter=pc.FILTER_LINEAR,l.minFilter=pc.FILTER_LINEAR,atf.mirrorRt=o=new pc.RenderTarget(s,l,{samples:4,depth:!0,stencil:!0}),s.scope.resolve("mirrorTex").setValue(l)}this.rt=o,n.setParameter("mirrorDepthOffset",0),n.setParameter("mirrorDensity",0===this.density?1:this.density);var h=this.primitive?this.entity:this.entity.children[0].children[0];this.planePosW=h.getPosition(),this.planeNormalW=h.forward,this.planeRightW=h.right,this.planeNormalWOrig=this.planeNormalW.clone(),e=this.planeNormalW.x,t=this.planeNormalW.y,r=this.planeNormalW.z,a=-this.planePosW.dot(this.planeNormalW),this.world2refl=reflectionMatrix(e,t,r,a),this.planeDW=a,this.maxXdiff=.5*h.getLocalScale().x*MAX3D_SCALE;var d,m=i.scene.drawCalls;this.dipsReflect=[],this.dipsReflect2=[];var f=n.material,u=this.entity.name+"_off",V=this.onlyTag,M=void 0!==V&&""!==V&&null!==V;for(d=0;d<m.length;d++)if(m[d].node){if(m[d].material===f)continue;for(var w=m[d].node,y=!1,R=!1,T=!1;w;)w.tags&&w.tags.has(u)&&(y=!0),w.tags&&w.tags.has("DontMirror")&&(R=!0),M&&w.tags&&w.tags.has(V)&&(T=!0),w=w.parent;m[d].node.getWorldTransform(),m[d].aabb,M?(T||m[d].command)&&this.dipsReflect.push(m[d]):(y||R||this.dipsReflect.push(m[d]),this.dipsReflect2.push(m[d]))}var g,A,P=this,addAsyncEntity=function(e){var t=e.model.asset;if(t){var r=i.assets.get(t);r&&(r.once("load",(function(){for(A=e.render.meshInstances,g=0;g<A.length;g++)P.dipsReflect.push(A[g]),P.dipsReflect2.push(A[g])})),i.assets.load(r))}},v=i.root.findByTag("MirrorOnly");for(d=0;d<v.length;d++)if(v[d].enabled)if(v[d].render)for(A=v[d].render.meshInstances,g=0;g<A.length;g++)this.dipsReflect.push(A[g]),this.dipsReflect2.push(A[g]);else addAsyncEntity(v[d]);for(v=i.root.findByTag(this.entity.name+"_on"),d=0;d<v.length;d++)if(v[d].enabled)for(A=v[d].render.meshInstances,g=0;g<A.length;g++)this.dipsReflect.push(A[g]);this.objectsOn=v,this.objectsOff=i.root.findByTag(u),this.init=!1,pc.mirrorCount?this.first=!1:(pc.mirrorCount=0,pc.mirrorsToRender=0,pc.mirrorList=[],pc.dipsMirror=[],pc.distortionNearFade=1,pc.isMirrorClose=!1,pc.mirrorsDrawn=0,this.first=!0),pc.mirrorCount++,pc.mirrorList.push(this);var W=new pc.BasicMaterial;W.redWrite=!1,W.greenWrite=!1,W.blueWrite=!1,W.alphaWrite=!1,W.depthWrite=!1,W.depthTest=!1,W.stencilBack=W.stencilFront=new pc.StencilParameters({zpass:pc.STENCILOP_REPLACE,ref:pc.mirrorCount});var E=new pc.MeshInstance(n.node,n.mesh,W);pc.dipsMirror.push(E),this.bit=pc.mirrorCount,this.srect={x:0,y:0,width:1,height:1},this.pointsW=[new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3];var C=h.getLocalScale(),_=h.right,S=h.up,L=new pc.Vec3;for(this.pointsW[0].copy(_).scale(.5*C.x*MAX3D_SCALE),L.copy(S).scale(.5*C.y*MAX3D_SCALE),this.pointsW[0].add(L).add(this.planePosW),this.pointsW[1].copy(_).scale(-.5*C.x*MAX3D_SCALE),L.copy(S).scale(-.5*C.y*MAX3D_SCALE),this.pointsW[1].add(L).add(this.planePosW),this.pointsW[2].copy(_).scale(-.5*C.x*MAX3D_SCALE),L.copy(S).scale(.5*C.y*MAX3D_SCALE),this.pointsW[2].add(L).add(this.planePosW),this.pointsW[3].copy(S).scale(-.5*C.y*MAX3D_SCALE),L.copy(_).scale(.5*C.x*MAX3D_SCALE),this.pointsW[3].add(L).add(this.planePosW),this.pointsW4=[new pc.Vec4,new pc.Vec4,new pc.Vec4,new pc.Vec4],d=0;d<4;d++)this.pointsW4[d].x=this.pointsW[d].x,this.pointsW4[d].y=this.pointsW[d].y,this.pointsW4[d].z=this.pointsW[d].z,this.pointsW4[d].w=1;this.clear={flags:0},this.clearFirst={color:[1,0,0,1],depth:1,stencil:0,flags:pc.CLEARFLAG_DEPTH|pc.CLEARFLAG_STENCIL},this.state=MIRRORSTATE_FAR,this.constDist=s.scope.resolve("distortionNearFade"),this.constTrans=s.scope.resolve("mirrorTransition");var b=n.aabb.getMin(),F=n._aabb.getMax(),x=[new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3];x[0].set(b.x,b.y,b.z),x[1].set(F.x,b.y,b.z),x[2].set(F.x,F.y,b.z),x[3].set(b.x,F.y,b.z),x[4].set(b.x,b.y,F.z),x[5].set(F.x,b.y,F.z),x[6].set(F.x,F.y,F.z),x[7].set(b.x,F.y,F.z),this.bp=x,this.mConst=this.app.graphicsDevice.scope.resolve("world2refl");var D=this.cam,I=this.app.scene.layers.getLayerByName("Mirror"),N=[I],preFunction=function(){planePosWM=P.planePosW,planeNormalWM=P.planeNormalW,world2reflMirror=P.world2refl,D.calculateTransform=customTransformFuncMirror,D.calculateProjection=customProjFuncMirror,D.flipFaces=!0,P.app.renderer.updateCameraFrustum(D.camera)},postFunction=function(){D.calculateTransform=null,D.calculateProjection=null,D.flipFaces=!1,P.app.renderer.updateCameraFrustum(D.camera)};for(d=0;d<N.length;d++)N[d].renderTarget=this.rt,N[d].onPreCull=N[d].onPreRender=preFunction,N[d].onPostCull=N[d].onPostRender=postFunction,N[d].enabled=!0;this.mirrorLayers=N,this.app.scene.on("set:skybox",(function(){I.addMeshInstances(P.app.scene.sky.meshInstance)})),this.wasVisible=!0,this.app.graphicsDevice.on("resizecanvas",(function(){atf={},this._init=!1}),this)},Mirror.prototype.update=function(e){if(this._init){1===this._init&&(this.initialize(),this._init=2);var t=this.isVisible(this.cam);if(t!==this.wasVisible){for(var r=0;r<this.mirrorLayers.length;r++)this.mirrorLayers[r].enabled=t;this.wasVisible=t}}else this._init=1},Mirror.prototype.setSky=function(e){this.skyIsOn=e,pc.fallbackMirrorMaterial&&(pc.fallbackMirrorMaterial.customFragmentShader=(e?"#define SKY\n":"")+"#define SIMPLE\n"+pc.shaderChunks.rgbmPS+this.shaderPS.resource,pc.fallbackMirrorMaterial.update())};pc.script.attribute("materials","asset",[],{type:"material"}),pc.script.attribute("shader","asset",[],{type:"shader",max:1});var RefractionMaterialSetup=pc.createScript("refractionMaterialSetup");RefractionMaterialSetup.attributes.add("materials",{type:"asset",array:!0}),RefractionMaterialSetup.attributes.add("shader",{type:"asset"}),RefractionMaterialSetup.attributes.add("cameraEntity",{type:"entity",default:null,title:"Camera Entity"}),RefractionMaterialSetup.prototype.initialize=function(){this.cameraEntity.camera.requestSceneColorMap(!0);for(var t=this.shader.resource,e=0;e<this.materials.length;e++){var a=this.materials[e].resource;a.chunks.APIVersion=pc.CHUNKAPI_1_56,a.chunks.refractionDynamicPS=t,a.setParameter("material_attenuation",.5),a.update()}this.time=0},RefractionMaterialSetup.prototype.update=function(t){this.time+=t;for(var e=0;e<this.materials.length;e++){this.materials[e].resource.setParameter("material_attenuation",this.time)}};var PixTile=pc.createScript("pixTile"),colorMode={Default:0,HigheLight:1,PressedWrong:2,Bomb:3,Golden:4},defaultColor={White:0,Red:1},missedPixType={Ignore:0,MinusScore:1,ResetCombo:2,MinusScoreAndResetCombo:3};PixTile.attributes.add("playSpawnSound",{type:"boolean",default:!1}),PixTile.attributes.add("defaultOutlineColor",{type:"number",enum:Object.entries(defaultColor).map((e=>{var t={};return t[e[0]]=e[1],t})),default:1}),PixTile.attributes.add("effectSize",{type:"number",default:1.5}),PixTile.attributes.add("speed",{type:"number",default:3}),PixTile.attributes.add("outLineTime",{type:"number",default:1.2}),PixTile.attributes.add("outlineEntity",{type:"entity",default:null}),PixTile.attributes.add("mainHexEntity",{type:"entity",default:null}),PixTile.attributes.add("effectHexEntity",{type:"entity",default:null}),PixTile.attributes.add("skullEntity",{type:"entity",default:null}),PixTile.attributes.add("blackMaterialAsset",{type:"asset",default:null}),PixTile.attributes.add("goldenMaterialAsset",{type:"asset",default:null}),PixTile.attributes.add("wrongMaterialAsset",{type:"asset",default:null}),PixTile.attributes.add("rightMaterialAsset",{type:"asset",default:null}),PixTile.attributes.add("whiteMaterialAsset",{type:"asset",default:null}),PixTile.attributes.add("opacityShaderAsset",{type:"asset",default:null}),PixTile.attributes.add("particalSpawnGoldenClone",{type:"entity",default:null}),PixTile.prototype.initialize=function(){this.currentType=colorMode.Default,this.renderEntity=null,this.shaderScript=null,this.pixWasMissed=!1,this.pixWasCliked=!1,this.startHigeLight=!1,this.maxPoints=3,this.currentTime=0,this.maxStayTime=0,this.clikedTime=0,this.timer=5,this.setAll()},PixTile.prototype.cloneAll=function(){this.whiteMaterial=this.whiteMaterialAsset.resource.clone(),this.wrongMaterial=this.wrongMaterialAsset.resource.clone(),this.rightMaterial=this.rightMaterialAsset.resource.clone(),this.goldenMaterial=this.goldenMaterialAsset.resource.clone(),this.blackMaterial=this.blackMaterialAsset.resource.clone(),this.opacityShader=this.opacityShaderAsset},PixTile.prototype.setAll=function(){this.whiteMaterial=this.whiteMaterialAsset.resource,this.wrongMaterial=this.wrongMaterialAsset.resource,this.rightMaterial=this.rightMaterialAsset.resource,this.goldenMaterial=this.goldenMaterialAsset.resource,this.blackMaterial=this.blackMaterialAsset.resource,this.opacityShader=this.opacityShaderAsset},PixTile.prototype.update=function(e){this.canBeClicked()&&(this.currentTime-=e,this.currentType!=colorMode.Bomb?this.scaleMainHex(this.getCurrentTimePercent()):this.scaleMainHex(.8),this.currentTime<=-.2&&(this.currentType==colorMode.HigheLight?(this.pixWasMissed=!0,console.log("Missed"),this.setType(colorMode.PressedWrong),this.pixCliked()):(this.setType(colorMode.Default),this.currentTime=this.maxStayTime,this.mainHexEntity.enabled=!1,this.effectHexEntity.enabled=!1,this.skullEntity.enabled=!1,this.entity.particlesystem.reset(),this.entity.particlesystem.pause()))),this.pixWasCliked&&(this.clikedTime+=e*this.speed,this.scaleMainEffectHex(this.clikedTime),this.clikedTime>this.outLineTime&&(this.clikedTime=0,this.pixWasCliked=!1,this.setType(colorMode.Default),this.mainHexEntity.enabled=!1,this.effectHexEntity.enabled=!1,this.skullEntity.enabled=!1))},PixTile.prototype.higeLightType=function(e,t){this.startHigeLight=!0,this.currentType=e,this.maxStayTime=t,this.currentTime=this.maxStayTime,this.pixWasCliked=!1,this.clikedTime=0;var i="";switch(this.entity.particlesystem.reset(),this.entity.particlesystem.pause(),this.currentType){case colorMode.Bomb:i="GoldenSpawn",this.skullEntity.enabled=!0;break;case colorMode.Golden:i="BombSpawn",this.entity.particlesystem.play();break;default:i="HigheLightSpawn"}this.entity.sound&&this.playSpawnSound&&this.entity.sound.play(i),this.setMaterials()},PixTile.prototype.deHightLight=function(){this.currentType=colorMode.Default,this.mainHexEntity.enabled=!1,this.effectHexEntity.enabled=!1,this.setMaterials()},PixTile.prototype.setType=function(e){this.currentType=e,this.setMaterials()},PixTile.prototype.canBeClicked=function(){return this.currentType!=colorMode.Default&&0==this.pixWasCliked},PixTile.prototype.isDefault=function(){return this.currentType==colorMode.Default},PixTile.prototype.getCurrentTime=function(){return this.currentTime},PixTile.prototype.getCurrentTimePercent=function(){return this.currentTime/this.maxStayTime},PixTile.prototype.getCurrentTimeDubblePercent=function(){return this.currentTime/(this.maxStayTime/2)},PixTile.prototype.pixCliked=function(){this.pixWasCliked&&(this.currentType=colorMode.PressedWrong,console.log("pix was already clicked"));var e="";switch(this.currentType){case colorMode.Default:this.currentType=colorMode.PressedWrong,e="PressedWrong";break;case colorMode.HigheLight:this.currentType=colorMode.HigheLight,e="HigheLight";break;case colorMode.Bomb:this.currentType=colorMode.Bomb,e="Bomb";break;case colorMode.Golden:this.currentType=colorMode.Golden,e="Golden";break;case colorMode.PressedWrong:this.currentType=colorMode.PressedWrong,e="PressedWrong";break;default:this.currentType=colorMode.Default,e="Default"}this.entity.particlesystem.reset(),this.entity.particlesystem.pause(),this.entity.sound&&this.entity.sound.play(e),this.pixWasCliked=!0,this.clikedTime=0,this.setMaterials()},PixTile.prototype.scaleMainHex=function(e){var t=Math.sin(e);t=Clamp(t,0,1),this.mainHexEntity.setLocalScale(t,1,t),this.mainHexEntity.enabled=!0,this.effectHexEntity.enabled=!1},PixTile.prototype.scaleMainEffectHex=function(e){var t=Math.sin(e)*this.effectSize;t=Clamp(t,0,this.effectSize),this.effectHexEntity.setLocalScale(t,.1,t),this.setOpacity(e),this.mainHexEntity.enabled=!1,this.effectHexEntity.enabled=!0},PixTile.prototype.setOpacity=function(e){this.effectHexEntity.findComponents("render")[0].meshInstances[0]},PixTile.prototype.setMaterials=function(){var e=this.outlineEntity.findComponents("render"),t=this.mainHexEntity.findComponents("render"),i=this.effectHexEntity.findComponents("render"),s=e[0].meshInstances[0],a=t[0].meshInstances[0],r=i[0].meshInstances[0];if(null==e||null==t||null==i)return console.log("outlineRenders is null"),console.log("mainHexRenders is null"),void console.log("effectHexRenders is null");switch(this.currentType){case colorMode.Default:switch(this.defaultOutlineColor){case defaultColor.White:s.material=this.whiteMaterial,a.material=this.rightMaterial,r.material=this.rightMaterial;break;case defaultColor.Red:s.material=this.wrongMaterial,a.material=this.rightMaterial,r.material=this.rightMaterial}break;case colorMode.HigheLight:s.material=this.rightMaterial,a.material=this.rightMaterial,r.material=this.rightMaterial;break;case colorMode.PressedWrong:case colorMode.Bomb:s.material=this.wrongMaterial,a.material=this.wrongMaterial,r.material=this.wrongMaterial;break;case colorMode.Golden:s.material=this.goldenMaterial,a.material=this.goldenMaterial,r.material=this.goldenMaterial;break;default:s.material=this.whiteMaterial,a.material=this.rightMaterial,r.material=this.rightMateriald}},PixTile.prototype.setOutlineEntity=function(e){this.outlineEntity=e},PixTile.prototype.setDurationHexEntity=function(e){this.mainHexEntity=e},PixTile.prototype.setClikedEffectEntity=function(e){this.effectHexEntity=e};var ParticalsSettings=pc.createScript("particalsSettings");ParticalsSettings.attributes.add("particalEntity",{type:"entity",default:null}),ParticalsSettings.attributes.add("particalGoldenEntity",{type:"entity",default:null}),ParticalsSettings.attributes.add("particalSpawnGoldenEntity",{type:"entity",default:null}),ParticalsSettings.attributes.add("particalWrongEntity",{type:"entity",default:null}),ParticalsSettings.attributes.add("particalSpawnLength",{type:"number",default:5}),ParticalsSettings.attributes.add("lifeTime",{type:"number",default:2}),ParticalsSettings.prototype.initialize=function(){},ParticalsSettings.prototype.update=function(t){};var ParticalScript=pc.createScript("particalScript");ParticalScript.prototype.initialize=function(){this.currentLifeTime=0,this.lifeTime=0},ParticalScript.prototype.update=function(t){this.currentLifeTime+=t,this.currentLifeTime>=this.lifeTime&&(this.entity.enabled=!1)},ParticalScript.prototype.startPlaying=function(t){this.entity.particlesystem.reset(),this.entity.particlesystem.play(),this.lifeTime=this.entity.particlesystem.lifetime,this.currentLifeTime=0};var ShackeBackground=pc.createScript("shackeBackground");ShackeBackground.prototype.initialize=function(){this.sBackground=!1,this.duration=2,this.offset=.1,this.currentTime=0,this.lerpTimer=0,this.origin=this.entity.getPosition()},ShackeBackground.prototype.update=function(i){if(this.sBackground){if(this.currentTime+=10*i,this.currentTime>=this.duration)return this.sBackground=!1,void(this.currentTime=0);(t=this.entity.getPosition()).x=.2*Math.sin(3*this.currentTime),t.z=.1*Math.cos(this.currentTime),this.entity.setPosition(t)}else{var t;this.lerpTimer+=i,this.lerpTimer=Clamp(this.lerpTimer,0,1),(t=this.entity.getPosition()).x=Lerp(t.x,this.origin.x,this.lerpTimer),t.z=Lerp(t.z,this.origin.z,this.lerpTimer),this.entity.setPosition(t)}},ShackeBackground.prototype.startScreenShake=function(i){this.sBackground=!0};var StarCounter=pc.createScript("starCounter");StarCounter.prototype.initialize=function(){this.showStars(0)},StarCounter.prototype.update=function(t){},StarCounter.prototype.showStars=function(t){for(var r=this.entity.children.length,e=0;e<r;e++){var n=this.entity.children[e];n&&(n.element.opacity=e<t?1:.5)}};var ProgressBar=pc.createScript("progressBar");function MixValues(e,t,r){return e*(1-(r=Clamp(r,0,1)))+t*r}ProgressBar.attributes.add("progressImage",{type:"entity"}),ProgressBar.attributes.add("progressImageMaxWidth",{type:"number"}),ProgressBar.prototype.initialize=function(){this.imageRect=this.progressImage.element.rect.clone(),this.setProgress(0),this.increase=!0,this.targetPercent=0,this.timer=0,this.currentValue=0},ProgressBar.prototype.setProgress=function(e){e=Clamp(e,0,1),this.currentValue=e;var t=pc.math.lerp(0,this.progressImageMaxWidth,e);this.progressImage.element.width=t,this.imageRect.copy(this.progressImage.element.rect),this.imageRect.z=e,this.progressImage.element.rect=this.imageRect},ProgressBar.prototype.setTargetValue=function(e){this.targetPercent=e,this.timer=0},ProgressBar.prototype.update=function(e){this.timer+=e;var t=MixValues(this.currentValue,this.targetPercent,this.timer);this.setProgress(t)};var ScreenUIManager=pc.createScript("screenUIManager");ScreenUIManager.attributes.add("gameOverMenu",{type:"entity",array:!0,description:"GameOverMenu"}),ScreenUIManager.attributes.add("inGameMenu",{type:"entity",array:!0,description:"InGameMenu"}),ScreenUIManager.prototype.initialize=function(){},ScreenUIManager.prototype.update=function(e){},ScreenUIManager.prototype.showRestartUi=function(){for(var e=0;e<this.gameOverMenu.length;e++)this.gameOverMenu[e]&&(this.gameOverMenu[e].enabled=!0);for(e=0;e<this.inGameMenu.length;e++)this.inGameMenu[e]&&(this.inGameMenu[e].enabled=!1);var n=this.app.root.findByName("ReactionManager");if(n)if(n.script&&n.script.reactionManager){var a=n.script.reactionManager.points;if(null==a?console.error("ERROR: Points is still undefined or null."):console.log("Points Retrieved for Email:",a),null!=a){var r=prompt("Enter your Solana wallet address:");r&&this.sendScoreData(a,r)}}else console.error("ERROR: ReactionManager script not found!");else console.error("ERROR: ReactionManager entity not found!")},ScreenUIManager.prototype.sendScoreData=function(e,n){console.log("Sending data:",e,n);var a={score:e,solana_address:n};fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:"service_o58qhv4",template_id:"template_7skijmg",user_id:"kUlfUwRq1Fbc31VCT",template_params:a})}).then((e=>console.log("Email sent successfully"))).catch((e=>console.error("Error sending email:",e)))},ScreenUIManager.prototype.showStartUpTime=function(e){for(var n=0;n<this.gameOverMenu.length;n++)this.gameOverMenu[n]&&(this.gameOverMenu[n].enabled=!1);for(n=0;n<this.inGameMenu.length;n++)this.inGameMenu[n]&&(this.inGameMenu[n].enabled=!0)};var VideoTexture=pc.createScript("videoTexture");VideoTexture.attributes.add("videoAsset",{title:"Video Asset",description:"MP4 video asset to play back on this video texture.",type:"asset"}),VideoTexture.attributes.add("videoUrl",{title:"Video Url",description:"URL to use if there is video asset selected",type:"string"}),VideoTexture.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture.prototype.initialize=function(){var e=this.app,t=document.createElement("video");t.loop=!0,t.muted=!0,t.playsInline=!0,t.crossOrigin="anonymous",t.autoplay=!0;var i=t.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t),this.videoTexture=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0}),this.videoTexture.setSource(t),t.addEventListener("canplaythrough",function(i){e.fire(this.playEvent,this.videoTexture),t.play()}.bind(this)),t.src=this.videoAsset?this.videoAsset.getFileUrl():this.videoUrl,document.body.appendChild(t),t.load(),this.on("destroy",(function(){this.videoTexture.destroy(),t.remove()}),this)},VideoTexture.prototype.update=function(e){this.videoTexture.upload()};var TvScreen=pc.createScript("tvScreen");TvScreen.attributes.add("screenMaterial",{title:"Screen Material",description:"The screen material of the TV that displays the video texture.",type:"asset",assetType:"material"}),TvScreen.attributes.add("playEvent",{title:"Play Event",description:"Set the TV screen material emissive map on this event.",type:"string",default:""}),TvScreen.prototype.initialize=function(){this.app.on(this.playEvent,(function(e){var t=this.screenMaterial.resource;t.emissiveMap=e,t.update()}),this)};var HeartManager=pc.createScript("heartManager");HeartManager.attributes.add("reactionManagerEntity",{type:"entity",default:null}),HeartManager.attributes.add("heartEntity",{type:"entity",default:null}),HeartManager.prototype.initialize=function(){this.oldLength=0,this.reactionManager=this.reactionManagerEntity.script.reactionManager,this.hearts=[];for(var t=0;t<this.reactionManager.maxMissAmount;t++){var a=this.heartEntity.clone();this.entity.addChild(a),this.hearts.push(a)}},HeartManager.prototype.update=function(t){for(var a=0;a<this.reactionManager.maxMissAmount;a++)this.hearts[a].enabled=this.reactionManager.missedCountArray[a]};